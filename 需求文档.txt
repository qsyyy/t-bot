bot的设计相关文档{

相关信息：现在是2025年，自从马斯克收购推特后他升级了推特api版本，现在的免费版推特api，每月限额100次请求。每次请求都有15分钟的冷却时间。并且访问GET/2/users/{id}/liked_tweets这种端点需要使用OAuth 2.0 Authorization Code Flow with PKCE来进行授权验证。而且马斯卡收购推特后将推特的域名从twitter改成x。这导致了相关域名都发生变化。


目前的运行环境：anaconda  python version : 3.12.7

	
概述：开发一个可将指定Twitter账号点赞内容自动同步到Telegram频道的机器人，遵守Twitter API v2使用限制，保证每月API调用不超过100次。

bot的触发方式：调整成每日固定a.m.6:00和p.m.10:00各运行一次，
	另设在telegram频道中和直接私聊bot使用指定命令/update触发运行。若/update是在频道中发送的则在运行结束后删除启动指令。需要注意私聊和频道监听的不同之处。
	
	
bot的功能：
	1.使用OAuth 2.0 Authorization Code Flow with PKCE获取的tokens来拉取指定用户的点赞列表。数量为100。（目前在测试阶段，暂时设为25）
	2.由于liked_tweets端点，返回的推文默认是按用户点赞的时间倒序排列，且不支持查看具体的点赞时间。
	使用某种手段保存拉取的点赞列表最新的推文id，这个保存手段需要保证bot停止运行再启动后仍能读取到。
	每次运行后拉取的点赞数据与上一次的记录互相比较。找出新增的点赞。然后把此次最新的点赞推文id更新到new_likes_id。
	
	3.需要获取的内容有？用户昵称，用户主页url，推文，图片，媒体，gif。
	获取到媒体后，筛出最高比特率的视频url。存到对应的表中。我记得gif在推特上也是mp4格式的，就按视频一样处理吧。
	
	4.根据获取到的新增推文构造telegram消息。将每条推特都通过telegram bot的api发送到频道中。发送时每6秒发送一条消息。
	
	5.构造telegram消息的要求：
		5.1 一般来说推文附带的媒体不会超过4张图片或者视频。所以我们可以直接把推文附带的图片和视频跟推文打包在一起发送。
		5.2 所有推文都单独发送
		5.3 构造的格式。  1）媒体在消息的上方。
		2）下面第一行的文字是推文发送者的昵称。该昵称附上发送者的主页url，点击可以跳转。昵称后面加个冒号。
		3）另起一行是正文文本。
		4）再另起一行将推文的url放在这里。
	
	6.由于推特的免费api的请求数极少。所以给bot的运行也设置冷却时间，防止误启动。每天只允许一次手动运行。保证请求次数不超过一百次/月
	7.还需要有报错代码。
	8.通过OAuth 2.0 Authorization Code Flow with PKCE获取tokens，并定时刷新保证授权不失效。该认证方式需要生成授权链接，使用/auth命令完成OAuth认证，用户认证后将完整url发送给bot，bot解析出code，向api申请令牌。推特开发者门户里设置的客户端类型是confidential clients。
    9.设置的回调地址是
	9.由于该bot运行在我的本地电脑或者手机上。我要求该bot的配置可以在其他电脑或者手机的conda环境里无缝迁移启动。我会使用git来推送和拉取bot主程序，通过其他方式配置.env
}